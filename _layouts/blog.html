---
layout: default
---

<section class="hero is-fullheight" id="blog">
    <div class="hero-body">
        <div class="container">
            {% include blogpage-heading.html %}
        </div>
    </div>
    
    <!--搜索结果容器-->
    <div id="results-container" style="display: none; padding: 0 2.5rem;"></div>
    
    <!--原始博客文章列表-->
    <div id="blog-posts-container">
        {% for post in site.posts %}
            {% include blog-card.html %}
        {% endfor %}
    </div>
</section>

<script type="text/javascript">
(function() {
    'use strict';
    
    // 文章数据
    var posts = [
        {% for post in site.posts %}
        {
            title: {{ post.title | jsonify }},
            description: {{ post.description | jsonify }},
            tags: "{{ post.tags | join: ', ' }}",
            url: "{{ site.baseurl }}{{ post.url }}",
            date: "{{ post.date | date: '%B %-d, %Y' }}",
            readtime: "{{ post.content | number_of_words | divided_by:180 }}",
            image: "{{ post.post-image }}"
        }{% unless forloop.last %},{% endunless %}
        {% endfor %}
    ];

    console.log('=== 搜索功能加载 ===');
    console.log('文章数量:', posts.length);

    function init() {
        var searchInput = document.getElementById('search');
        var searchButton = document.getElementById('search-button');
        var blogPostsContainer = document.getElementById('blog-posts-container');
        var resultsContainer = document.getElementById('results-container');

        console.log('元素检查:', {
            searchInput: !!searchInput,
            searchButton: !!searchButton,
            blogPostsContainer: !!blogPostsContainer,
            resultsContainer: !!resultsContainer
        });

        if (!searchInput || !blogPostsContainer || !resultsContainer) {
            console.error('关键元素缺失！');
            return;
        }

        function performSearch(query) {
            query = query.trim();
            console.log('搜索:', query);

            if (!query) {
                blogPostsContainer.style.display = 'block';
                resultsContainer.style.display = 'none';
                return;
            }

            var searchText = query.toLowerCase();
            var results = posts.filter(function(post) {
                return post.title.toLowerCase().indexOf(searchText) !== -1 ||
                       post.description.toLowerCase().indexOf(searchText) !== -1 ||
                       post.tags.toLowerCase().indexOf(searchText) !== -1;
            });

            console.log('结果数:', results.length);

            blogPostsContainer.style.display = 'none';
            resultsContainer.style.display = 'block';

            if (results.length === 0) {
                resultsContainer.innerHTML = '<div class="subtitle has-text-centered" style="padding:2rem">没有找到相关文章</div>';
            } else {
                resultsContainer.innerHTML = results.map(function(post) {
                    return '<div class="columns has-text-centered" style="border:0.15rem dashed black;margin-bottom:1.5rem">' +
                        '<div class="column is-one-third"><div class="image is-16by9" style="background-image:url(' + post.image + ')"></div></div>' +
                        '<a href="' + post.url + '"><div class="column has-text-left">' +
                        '<h1 class="title is-size-4-touch">' + post.title + '</h1>' +
                        '<div class="content has-text-grey">' + post.description +
                        '<hr><span>Published on <b>' + post.date + '</b></span> | <i class="fas fa-clock"></i> <b>' + post.readtime + ' min</b> read</div>' +
                        '</div></a></div>';
                }).join('');
            }
        }

        searchInput.addEventListener('input', function() {
            performSearch(this.value);
        });

        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') performSearch(this.value);
        });

        if (searchButton) {
            searchButton.addEventListener('click', function() {
                performSearch(searchInput.value);
            });
        }

        console.log('✅ 搜索功能已激活');
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
})();
</script>